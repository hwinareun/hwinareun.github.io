---
title: TIL(5w5d)
date: 2024-05-11 00:40:00 +09:00
categories: [Studying, 데브코스,TIL]
tags: 
  [데브코스, til, backend, db, sql]
---

# YOUTUBE-DEMO 실습
## DB 모듈화
```jsx
// mydb.js
...
const connection = mysql.createConnection({
  ...
});
module.exports = connection
```
```jsx
// users
...
const conn = require('../mydb')

conn.query(
    'SELECT * FROM `users`',
    function (err, results, fields) {
      ...
    }
);
...
```

---

## get -users db 연동
- (GET: 회원 개별 조회)(/users)**(SQL: SELECT)**
  - req: body(userId) **--> body(email)**
  - res: userId, name **--> 회원 객체를 통으로 전달**

```jsx
...
    .get((req,res) => {
        let {email} = req.body

        conn.query(
            `SELECT * FROM users WHERE email = ${email}`,
            function (err, results, fields) {
                if(results.length)
                    res.status(200).json(results)
                else {
                    res.status(404).json({
                message: "회원 정보가 없습니다."
            })
                }
            }
        );  
    })
...
// postman에서 send 하면 오류 발생 `Error: socket hang up`
```

---

## 오류 해결, select sql 쿼리 형식
`Error: socket hang up`
: '통신이 끊겼다'는 뜻.
```jsx
...
    .get((req,res) => {
        let {email} = req.body

        conn.query(
            `SELECT * FROM users WHERE email = ?`, email,
            function (err, results, fields) {
              res.status(200).json(results) 
            }
        );  
    })
```
![image]()

---

## 회원가입 INSERT
- (POST: 회원가입)(/join)**(SQL: INSERT)**
  - req: body(userId, pwd, name) **--> body(email, name, pwd, contact)**
  - res: `${name}님 환영합니다`
```jsx
router.post('/join', (req,res) => {
    if(req.body){
        const {email, name, password, contact} = req.body

        conn.query(
            `INSERT INTO users (email, name, password, contact) VALUES (?,?,?,?)`, [email, name, password, contact],
            function (err, results, fields) {
                    res.status(201).json(results)    
            }
        );  
    }
    ...
})
```

## delete
- (DELETE: 회원 개별 탈퇴)(/users)**(SQL: DELETE)**
  - req: body(userId) **--> body(email)**
  - res: `${name}님의 계정이 삭제되었습니다.`
```jsx
 .delete((req,res) => {
        let {email} = req.body

        conn.query(
            `DELETE FROM users WHERE email = ?`, email,
            function (err, results, fields) {
                    res.status(200).json(results)  
            }
        );  
    })
```

## 로그인
- (POST: 회원 로그인)(/login)**(SQL: SELECT)**
  - req: body(userId, pwd) **--> body(email, password)**
  - res: `${name}님 환영합니다`
```jsx
router.post('/login', (req,res) => {
    let {email, password} = req.body

    conn.query(
        `SELECT * FROM users WHERE email = ?`, email,
        function (err, results, fields) {
            let loginUser = results[0];
            
            if(loginUser && loginUser.password == password){
                res.status(200).json({
                    message: `${loginUser.name}님, 로그인 되었습니다.`
                })
            } else {
                res.status(404).json({
                    message: `이메일 또는 비밀번호가 틀렸습니다.`
                })
            }
        }
    );  
})
```

## users.js 코드 정리 - 리팩토링
![image]()

## channels.js
- (POST: 생성)(/channels)**(SQL: INSERT)**
  - req: body(channelsTitle, userId) **--> body(name, userID)**
  - res(201): `${channelsTitle}에 접속.` **--> `${name}에 접속.`
- 수정(PUT)(/channels/:id) **(SQL: UPDATE)**
  - req: URL(id), body(channelsTitle) **--> body(name)**
  - res(200): `${}에서 ${}으로 수정.`
- 개별 삭제(DELETE)(/channels/:id) **(SQL: DELETE)**
  - req: URL(id)
  - res(200): `삭제 완료`
- 전체 조회(GET)(/channels) **(SQL: SELECT)**
  - req: body(userId) 
  - res(200): 채널 전체 데이터
- 개별 조회(GET)(/channels/:id) **(SQL: SELECT)**
  - req: URL(id)
  - res(200): 채널 개별 데이터

![image]()

## INSERT 할 때 userId 값이 이상해서 실패해도 201이라니?!

유효성 검사 필요함 !! ==> 다음 강의에서 학습 예정